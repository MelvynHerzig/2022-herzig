#include "filestring.h"

using namespace std;

namespace Tucuxi {
namespace Xpert {


/**************************************************************
 *                             CSS                            *
 * ************************************************************/

const string FileString::normalizeCssStr = "/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */progress,sub,sup{vertical-align:baseline}*,::after,::before{box-sizing:border-box}html{-moz-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji'}hr{height:0;color:inherit}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,'Liberation Mono',Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:ButtonText dotted 1px}:-moz-ui-invalid{box-shadow:none}legend{padding:0}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}";

const string FileString::tuberxpertCssStr = ".underline,h3,h4{text-decoration:underline}.adjustments>tbody>tr:first-child,.computation-covariates>tbody>tr:first-child,.drug-intro>tbody>tr:first-child,.page-A4,.pks>tbody>tr:first-child,.targets>tbody>tr:first-child{background-color:#fff}.page-A4{width:21cm;margin:auto;padding:0 1cm}.contacts,table{width:100%}.page-A4>table>tbody>div[class=canvasAdjustments],.page-A4>table>tbody>tr{page-break-inside:avoid}.newpage{page-break-before:always}html{height:fit-content}h1,h2,h3,h4,h5{margin:0}h4,h5{margin-bottom:1rem}.contacts,.copyright,table{margin-left:auto;margin-right:auto}h3{margin-bottom:1.5rem;margin-top:1.5rem}.page-A4>div,h4,h5{margin-top:1rem}hr{border:1px solid #000;margin-top:.2cm;margin-bottom:.5cm}body{background-color:#525659}.bg-light-grey{background-color:#f1f1f1}.bg-warning-normal{background-color:#e8c882}.bg-warning-critical{background-color:#e5807f}table{column-gap:.5cm;table-layout:fixed;border-collapse:collapse}table,td,th{border:transparent}td,th{vertical-align:top;word-wrap:break-word;padding:3px}table table{width:99%;margin:auto auto 3px}table table td{vertical-align:middle}table table td:first-child{width:6%;padding:5px}.header tr td{width:33%;vertical-align:bottom}.header tr td:nth-child(2){vertical-align:bottom;text-align:center;text-decoration:underline}.contacts tr th,.header tr td:nth-child(3){text-align:right}.adjustments tr>td:first-child,.computation-covariates tr>td:first-child,.copyright,.pks tr>td:first-child,.targets tr>td:first-child,.treatment table tr td:first-child{text-align:center}.adjustments th,.computation-covariates th,.covariates th,.drug-intro th,.pks th,.targets th{text-align:left}.drug-intro tr th:first-child,.pks th:nth-child(3),.pks th:nth-child(4),.pks th:nth-child(5){width:25%}.adjustments th:nth-child(2),.adjustments th:nth-child(3),.drug-intro tr th:nth-child(2),.pks th:nth-child(2),.targets th:nth-child(2){width:20%}.drug-intro tr th:nth-child(3){width:55%}.contacts-header tr th:first-child{width:24%}.contacts-header tr th:nth-child(2),.contacts-header tr th:nth-child(3){width:38%}.contacts tr td:first-child{width:6%;vertical-align:middle;text-align:center}.contacts tr th{width:17%;border-right:1px solid #000;padding-right:4px}.contacts tr td:nth-child(2),.contacts tr td:nth-child(3){width:38%;padding-left:4px}.clinical-data tr th{width:25%;text-align:right}.clinical-data tr td{width:75%;vertical-align:top;text-align:left;padding-left:8px}.adjustments>tbody>tr:nth-of-type(2n+4),.clinical-data tr+tr,.computation-covariates>tbody>tr:nth-of-type(1n+3),.covariates>tbody>tr:nth-of-type(3n+4),.pks>tbody>tr:nth-of-type(1n+3),.samples>tbody>tr:nth-of-type(2n+3),.targets>tbody>tr:nth-of-type(2n+4),.treatment>tbody>tr:nth-of-type(3n){border-top:4px solid #fff}.treatment img[src='asset/img/dot.png']{margin-top:3px}.adjustments tr>td:first-child>img,.computation-covariates tr>td:first-child>img,.pks tr>td:first-child>img,.targets tr>td:first-child>img{padding-top:2px}.adjustments th:first-child,.computation-covariates th:first-child,.pks th:first-child,.targets th:first-child{width:5%}.adjustments tr[class=loading-dose],.targets tr[class=target-values]{margin-right:1cm;padding-right:1cm}.adjustments div,.targets div{text-align:left;background-color:silver;margin-left:1cm;margin-right:3px;padding-left:3px;padding-right:3px}.targets th:nth-child(3){width:60%}.targets th:nth-child(4){width:15%}.predictions th{width:40%;text-align:end;background-color:#fff;padding-right:6px}.predictions td{width:60%;padding-left:6px}.canvasAdjustments,.canvasAdjustments>canvas{height:12.6cm;width:19cm}.computation-covariates th:nth-child(2){width:45%}.copyright{margin-top:.5cm;width:100%;font-size:x-small}";

/**************************************************************
 *                             JS                            *
 * ************************************************************/

const string FileString::graphdataJsStr = "'use strict';var _createClass=function(){function a(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,'value'in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var GraphPercentileDataList=function(){function a(){_classCallCheck(this,a),this.plist=[],this.isValid=!1}return _createClass(a,[{key:'isEmpty',value:function(){return 0==this.plist.length}},{key:'size',value:function(){return this.plist.length}},{key:'objat',value:function(a){return this.plist[a]}},{key:'append',value:function(a){this.plist.push(a)}}]),a}(),GraphFancyPoint=function(){function a(b,c){_classCallCheck(this,a),this.times=b,this.values=c}return _createClass(a,[{key:'times',value:function(){return this.times}},{key:'values',value:function(){return this.values}}]),a}(),GraphPredictionData=function(){function a(b,c){_classCallCheck(this,a),this.time=b,this.value=c,this.troughs=[0],this.peaks=[],this.isValid=!1,this.selected=!1}return _createClass(a,[{key:'times',value:function(){return this.time}},{key:'values',value:function(){return this.value}},{key:'meanAt',value:function(a){return 10}},{key:'timeAt',value:function(a){return this.time[a]}},{key:'valueAt',value:function(a){return this.value[a]}},{key:'aucAt',value:function(a){return 20}},{key:'auc24At',value:function(a){return 30}},{key:'cumulatedAucAt',value:function(a){return 40}},{key:'troughAt',value:function(a){return 50}},{key:'peakAt',value:function(a){return 60}},{key:'timeAfterDose',value:function(a){return 70}},{key:'cycleDuration',value:function(a){return 80}}]),a}(),GraphPercentileData=function a(){_classCallCheck(this,a),this.percentile=0,this.predictionData=null},GraphPredictive=function a(){_classCallCheck(this,a),this.predictionData=new GraphPredictionData,this.percentilePairs=new GraphPercentileDataList},GraphPredictionResult=function a(){_classCallCheck(this,a),this.predictive=new GraphPredictive},GraphInformationSelection=function a(){_classCallCheck(this,a),this.presentPopulationPrediction=!0,this.displayPopulationPrediction=!0,this.presentAprioriPrediction=!0,this.displayAprioriPrediction=!0,this.presentAposterioriPrediction=!0,this.displayAposterioriPrediction=!0,this.presentPopulationPercentiles=!0,this.displayPopulationPercentiles=!0,this.presentAprioriPercentiles=!0,this.displayAprioriPercentiles=!0,this.presentAposterioriPercentiles=!0,this.displayAposterioriPercentiles=!0,this.presentPossibleAdjustments=!0,this.displayPossibleAdjustments=!0,this.presentSelectedAdjustments=!0,this.displaySelectedAdjustments=!0,this.presentMeasures=!0,this.displayMeasures=!0,this.presentTargets=!0,this.displayTargets=!0,this.displayCovariateChange=!0,this.displayCurrentTime=!0,this.perc50=!0,this.perc25_75=!0,this.perc10_90=!0,this.perc5_95=!0},GraphCovariate=function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:new Date(Date.now()-432e5);_classCallCheck(this,a),this.date=b},GraphDosage=function a(){_classCallCheck(this,a),this.applied=new Date(Date.now()-864e5),this.endtime=new Date(Date.now()+864e5)},GraphIdentifiableAmount=function a(b,c,d){_classCallCheck(this,a),this.dbvalue=b,this.multiplier=c,this.unitstring=d},GraphMeasure=function a(b,c,d,e){_classCallCheck(this,a),this.moment=b,this.concentration=new GraphIdentifiableAmount(c,d,e)},GraphTargetMethod=function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,a),this.value=b},GraphAmount=function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,a),this.dbvalue=b,this.multiplier=c},GraphTarget=function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:2,e=arguments.length>3&& void 0!==arguments[3]?arguments[3]:10;_classCallCheck(this,a),this.type=new GraphTargetMethod(b),this.cbest=new GraphAmount(d,1),this.cmin=new GraphAmount(c,1),this.cmax=new GraphAmount(e,1)},GraphAdjustment=function a(){_classCallCheck(this,a),this.predictionData=new GraphPredictionData([],[])},GraphAdjustments=function(){function a(){_classCallCheck(this,a),this.alist=[],this.isValid=!1}return _createClass(a,[{key:'append',value:function(a){this.alist.push(a)}},{key:'isEmpty',value:function(){return 0==this.alist.length}},{key:'size',value:function(){return this.alist.length}},{key:'objat',value:function(a){return this.alist[a]}}]),a}(),GraphMouseArea=function a(){_classCallCheck(this,a),this.mouseX=-1,this.mouseY=-1,this.containsMouse=!1,this.isMouseOver=!1,this.tooltipX=-1,this.tooltipY=-1},GraphFullData=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:1;_classCallCheck(this,a),this.scale=b,this.canvas=null,this.annotationsCanvas=null,this.clockCanvas=null,this.colors=['#bfbfbf','#3c4042','#004375','#9abfe7','#269043','#e8a45c','#8cda75','#aaaeb2','#9abfe7','black'],this.popcolors=['#aaaeb2','#D2D6DA','#E0E2E6','#EAEEF0'],this.aprcolors=['#9abfe7','#9AE8E2','#B6F4F0','#DEFEFC'],this.apocolors=['#8cda75','#8CECA6','#B4FABA','#D6FCDA'],this.adjcolors=['#323232','#969696','#646464'],this.revcolors=[],this.pop=0,this.apr=1,this.apo=2,this.rev=3,this.mea=4,this.tar=5,this.adj=6,this.indices=['pop','apr','apo','rev','mea','tar','adj'],this.nographtext='Welcome to Tucuxi! Graphs of predicted concentrations will be shown here.',this.hasMeasure=!1,this.hasPatientVariates=!1,this.hasTargets=!0,this.popercsP=new GraphPercentileDataList,this.aprpercsP=new GraphPercentileDataList,this.apopercsP=new GraphPercentileDataList,this.adjpercsP=new GraphPercentileDataList,this.popP=new GraphPredictionResult,this.aprP=new GraphPredictionResult,this.apoP=new GraphPredictionResult,this.adjP=new GraphPredictionResult,this.revP=new GraphAdjustments,this.measures=[],this.targets=[],this.pvars=[],this.dosages=[],this.scaleMax=20,this.scaleMin=.002,this.police='sans-serif',1==b?(this.fontSize='12px',this.axisTicksFontSize='10px',this.tooltipFontSize='10px'):2==b?(this.fontSize='24px',this.axisTicksFontSize='20px',this.tooltipFontSize='20px'):4==b&&(this.fontSize='48px',this.axisTicksFontSize='40px',this.tooltipFontSize='40px'),this.yFactor=1,this.date=new Date,this.maxX=0,this.minX=0,this.maxY=0,this.minY=0,this.xRatio=0,this.yRatio=0,this.highlightthresh=15,this.currentPoints=[],this.closestPred={},this.currentMeasure=null,this.currentDosage=null,this.antialiasing=!0,this.isOffsetXEnabled=!0,this.isOffsetYEnabled=!0,this.unit='ug/l',this.unitefforder=1,this.gInformationSelection=new GraphInformationSelection,this.timestart,this.timeend,this.leftMargin=75*this.scale,this.rightMargin=75*this.scale,this.topMargin=75*this.scale,this.bottomMargin=75*this.scale,this.targetTabIndex=-1,this.mArea=new GraphMouseArea}return _createClass(a,[{key:'getViewRangeMin',value:function(){return this.timestart.getTime()/1e3}},{key:'getViewRangeMax',value:function(){return this.timeend.getTime()/1e3}},{key:'updateChartDimensions',value:function(a){this.scale<=1.5?(this.fontSize='12px',this.axisTicksFontSize='10px',this.tooltipFontSize='10px'):this.scale<=2.5?(this.fontSize='24px',this.axisTicksFontSize='20px',this.tooltipFontSize='20px'):this.scale<=4.5&&(this.fontSize='48px',this.axisTicksFontSize='40px',this.tooltipFontSize='40px'),this.leftMargin=75*this.scale,this.rightMargin=75*this.scale,this.topMargin=75*this.scale,this.bottomMargin=75*this.scale,this.topLeftX=this.leftMargin,this.topLeftY=this.topMargin,this.topRightX=a.width-this.rightMargin,this.topRightY=this.topMargin,this.bottomLeftX=this.leftMargin,this.bottomLeftY=a.height-this.bottomMargin,this.bottomRightX=a.width-this.rightMargin,this.bottomRightY=a.height-this.bottomMargin,this.plotWidth=this.topRightX-this.topLeftX,this.plotHeight=this.bottomLeftY-this.topLeftY}}]),a}();function preparePrediction(a,b){a.predictive.predictionData.isValid&&(a.X=a.predictive.predictionData.times(),a.Y=a.predictive.predictionData.values(),a.predictive.predictionData.displayTooltip=!0,a.predictive.predictionData.closestPoint={currentindex:0})}function preparePercs(a){if(a.isValid&&0!==a.size())for(var b=0;b<a.size();++b)a.objat(b).isValid&&(a.objat(b).X=a.objat(b).predictionData.times(),a.objat(b).Y=a.objat(b).predictionData.values(),a.objat(b).predictionData.closestPoint={currentindex:0})}";

const string FileString::graphingJsStr = "'use strict';function drawGraph(a){var b=a.canvas.getContext('2d');initContext(a,b),b.save(),extents(a);var d=a.gInformationSelection.displayAposterioriPrediction&&!a.hasPatientVariates&&!a.hasMeasures,e=a.gInformationSelection.displayAposterioriPrediction&&a.hasPatientVariates&&!a.hasMeasures;if(a.popP&&a.popP.predictive.predictionData.isValid&&((a.gInformationSelection.displayPopulationPercentiles||d)&&a.popercsP.isValid&&drawPercentiles(a,b,a.popercsP,a.colors[7],a.popcolors),a.aprP&&a.aprP.predictive.predictionData.isValid&&(a.gInformationSelection.displayAprioriPercentiles||e)&&a.aprpercsP.isValid&&drawPercentiles(a,b,a.aprpercsP,a.colors[8],a.aprcolors),a.apoP&&a.apoP.predictive.predictionData.isValid&&a.gInformationSelection.displayAposterioriPercentiles&&a.hasMeasures&&a.apopercsP.isValid&&drawPercentiles(a,b,a.apopercsP,a.colors[6],a.apocolors)),a.popP&&a.popP.predictive.predictionData.isValid&&((a.gInformationSelection.displayPopulationPrediction||d)&&drawPop(a,b,a.colors),a.aprP&&a.aprP.predictive.predictionData.isValid&&(a.gInformationSelection.displayAprioriPrediction||e)&&drawApr(a,b,a.colors),a.apoP&&a.apoP.predictive.predictionData.isValid&&a.gInformationSelection.displayAposterioriPrediction&&a.hasMeasures&&drawApo(a,b,a.colors)),a.aprP.predictive.predictionData.isValid&&checkAndDisplayDomain(a,b,a.aprP),a.adjP&&a.gInformationSelection.displaySelectedAdjustments&&(a.adjpercsP.isValid&&(a.apoP&&a.apoP.predictive.predictionData.isValid?drawPercentilesAdjustments(a,b,a.adjpercsP,a.apocolors[0],a.apocolors):drawPercentilesAdjustments(a,b,a.adjpercsP,a.aprcolors[0],a.aprcolors)),a.apoP&&a.apoP.predictive.predictionData.isValid),a.revP&&a.revP.isValid&&a.gInformationSelection.displayPossibleAdjustments&&drawReverse(a,b,a.colors,a.revcolors),a.gInformationSelection.displayMeasures&&(drawMeasures(a,b),b.restore(),b.save()),a.hasTargets&&a.gInformationSelection.displayTargets){if(a.apoP&&a.apoP.predictive.predictionData.isValid)drawTargets(a,b,a.apoP.X,a.apoP.predictive.predictionData);else if(a.aprP&&a.aprP.predictive.predictionData.isValid)drawTargets(a,b,a.aprP.X,a.aprP.predictive.predictionData);else if(a.popP&&a.popP.predictive.predictionData.isValid)drawTargets(a,b,a.popP.X,a.popP.predictive.predictionData);else if(a.adjP&&a.adjP.predictive.predictionData.isValid)drawTargets(a,b,a.adjP.X,a.adjP.predictive.predictionData);else if(a.revP&&a.revP.size()>0){var c=a.revP.alist[0].predictionData;c.isValid&&drawTargets(a,b,c.times(),c)}else{var f=ascreen2time(a,a.bottomLeftX),g=ascreen2time(a,a.bottomRightX);drawTargets(a,b,[f,g],null)}b.restore(),b.save()}clearBorder(a,b),drawNonPlotArea(a,b)}function checkAndDisplayDomain(a,b,c){c.isValidDomain||(b.textAlign='end',b.strokeText(c.domainMessage,a.topRightX,a.topRightY+10))}function getAdjustmentFilter(a,b){if(a.gInformationSelection.displaySelectedAdjustment){var c=a.adjustmentDate/1e3;return b?function(a){return a<c}:function(a){return a>c}}}function drawPop(a,b,c){drawCurve(a,b,a.popP.predictive.predictionData,c[1],getAdjustmentFilter(a,!0)),b.restore(),b.save()}function drawApr(a,b,c){drawCurve(a,b,a.aprP.predictive.predictionData,c[2],getAdjustmentFilter(a,!0)),b.restore(),b.save()}function drawApo(a,b,c){drawCurve(a,b,a.apoP.predictive.predictionData,c[4],getAdjustmentFilter(a,!0)),b.restore(),b.save()}function drawReverse(a,c,d,e){for(var b=0;b<a.revP.size();++b)(6>=a.revP.size()||a.revP.objat(b).predictionData.selected)&&drawCurve(a,c,a.revP.objat(b).predictionData,d[5],getAdjustmentFilter(a,!1)),c.restore(),c.save()}function drawAdjustment(a,b,c){drawCurve(a,b,a.adjP.predictive.predictionData,c,getAdjustmentFilter(a,!1)),b.restore(),b.save()}function drawPercentiles(b,c,a,g,e){var d=[];if(!(1>a.size())){b.gInformationSelection.perc5_95&&(colorRegionBtwCurves(b,c,a.objat(0).predictionData,a.objat(6).predictionData,a.objat(0).X,a.objat(0).Y,a.objat(6).Y,e[3],getAdjustmentFilter(b,!0)),c.restore(),c.save(),d.push(a.objat(0)),d.push(a.objat(6))),b.gInformationSelection.perc10_90&&(colorRegionBtwCurves(b,c,a.objat(1).predictionData,a.objat(5).predictionData,a.objat(0).X,a.objat(1).Y,a.objat(5).Y,e[2],getAdjustmentFilter(b,!0)),c.restore(),c.save(),d.push(a.objat(1)),d.push(a.objat(5))),b.gInformationSelection.perc25_75&&(colorRegionBtwCurves(b,c,a.objat(2).predictionData,a.objat(4).predictionData,a.objat(0).X,a.objat(2).Y,a.objat(4).Y,e[1],getAdjustmentFilter(b,!0)),c.restore(),c.save(),d.push(a.objat(2)),d.push(a.objat(4))),b.gInformationSelection.perc50&&d.push(a.objat(3));for(var f=0;f<d.length;++f)drawCurve(b,c,d[f].predictionData,g,getAdjustmentFilter(b,!0)),c.restore(),c.save()}}function drawPercentilesAdjustments(c,b,a,g,e){var d=[];if(!(1>a.size())){c.gInformationSelection.perc5_95&&(colorRegionBtwCurves(c,b,a.objat(0).predictionData,a.objat(6).predictionData,a.objat(0).X,a.objat(0).Y,a.objat(6).Y,e[3],!1),b.restore(),b.save(),d.push(a.objat(0)),d.push(a.objat(6))),c.gInformationSelection.perc10_90&&(colorRegionBtwCurves(c,b,a.objat(1).predictionData,a.objat(5).predictionData,a.objat(0).X,a.objat(1).Y,a.objat(5).Y,e[2],!1),b.restore(),b.save(),d.push(a.objat(1)),d.push(a.objat(5))),c.gInformationSelection.perc25_75&&(colorRegionBtwCurves(c,b,a.objat(2).predictionData,a.objat(4).predictionData,a.objat(0).X,a.objat(2).Y,a.objat(4).Y,e[1],!1),b.restore(),b.save(),d.push(a.objat(2)),d.push(a.objat(4))),c.gInformationSelection.perc50&&d.push(a.objat(3));for(var f=0;f<d.length;++f)drawCurve(c,b,d[f].predictionData,g,getAdjustmentFilter(c,!0)),b.restore(),b.save()}}function drawNonPlotArea(b,a){drawAxis(b,a),a.restore(),a.save(),drawAxisTicks(b,a),drawAxisLabels(b,a),drawLegends(b,a)}function drawSoftwareDescription(c,a,b){a.fillText(b,100,50)}function colorRegionBtwCurves(c,a,m,n,d,i,j,l,k){if(a.globalAlpha=.2,a.globalAlpha=1,a.lineWidth=2*c.scale,a.lineCap='round',a.lineJoin='round',a.beginPath(),void 0===d|| void 0===i){console.log('No data available in colorRegionBtwCurves');return}var g,e,h,f,b=0;for(g=atime2screen(c,d[b]),h=acxn2screen(c,i[b]),a.moveTo(g,h);b<d.length-1&&(!k||k(d[b+1]));b++)e=atime2screen(c,d[b+1]),f=acxn2screen(c,i[b+1]),a.lineTo(e,f);for(a.lineTo(e,f),g=atime2screen(c,d[b]),h=acxn2screen(c,j[b]),a.lineTo(g,h);b> -1;b--)e=atime2screen(c,d[b-1]),f=acxn2screen(c,j[b-1]),a.lineTo(e,f);a.closePath(),a.fillStyle=l,a.fill()}function initContext(a,b){b.clearRect(0,0,a.canvas.width,a.canvas.height),a.hasMeasures=a.measures&&a.measures.length>0,a.hasPatientVariates=a.pvars&&a.pvars.length>0,a.hasTargets=a.targets&&a.targets.length>0,b.font=a.fontSize+' '+a.police,b.globalAlpha=1,b.lineWidth=1,b.strokeStyle='black',b.fillStyle='black'}function extents(a){a.minX=a.getViewRangeMin(),a.maxX=a.getViewRangeMax();var b,f=0,k=0,g=0,l=0,h=0,m=0,i=0,n=0,d=0,j=0;if(a.popercsP&&!a.popercsP.isEmpty())for(b=0;b<a.popercsP.size();++b)h=Math.max(h,Math.max.apply(Math,a.popercsP.objat(b).Y)),m=Math.min(m,Math.min.apply(Math,a.popercsP.objat(b).Y));if(a.aprpercsP&&!a.aprpercsP.isEmpty())for(b=0;b<a.aprpercsP.size();++b)f=Math.max(f,Math.max.apply(Math,a.aprpercsP.objat(b).Y)),k=Math.min(k,Math.min.apply(Math,a.aprpercsP.objat(b).Y));if(a.apopercsP&&!a.apopercsP.isEmpty())for(b=0;b<a.apopercsP.size();++b)g=Math.max(g,Math.max.apply(Math,a.apopercsP.objat(b).Y)),l=Math.min(l,Math.min.apply(Math,a.apopercsP.objat(b).Y));if(a.adjpercsP&&!a.adjpercsP.isEmpty())for(b=0;b<a.adjpercsP.size();++b)i=Math.max(i,Math.max.apply(Math,a.adjpercsP.objat(b).Y)),n=Math.min(n,Math.min.apply(Math,a.adjpercsP.objat(b).Y));if(a.revP&&!a.revP.isEmpty())for(b=0;b<a.revP.size();++b)(5>=a.revP.size()||a.revP.objat(b).predictionData.selected)&&(d=Math.max(d,Math.max.apply(Math,a.revP.alist[b].predictionData.value)),0==b&&(j=d),j=Math.min(j,Math.min.apply(Math,a.revP.alist[b].predictionData.value)));var c=0;if(a.popP&&(c=Math.max(c,Math.max.apply(Math,a.popP.Y))),a.aprP&&(c=Math.max(c,Math.max.apply(Math,a.aprP.Y))),a.apoP&&(c=Math.max(c,Math.max.apply(Math,a.apoP.Y))),a.adjP&&(c=Math.max(c,Math.max.apply(Math,a.adjP.Y))),a.maxY=Math.max(c,h,f,g,i,d),0==a.maxY)for(var e=0;e<a.targets.length;++e){var o=a.targets[e].cmax.dbvalue*a.targets[e].cmax.multiplier;o>a.maxY&&(a.maxY=o)}a.maxY=a.maxY*a.yFactor;var p=Math.pow(10,Math.ceil(Math.log(1.1*a.maxY)/Math.LN10)-1);a.maxY=Math.ceil(1.1/p*a.maxY)*p,a.xRatio=a.plotWidth/(a.maxX-a.minX),a.yRatio=a.plotHeight/(a.maxY-a.minY)}function drawCurve(c,a,e,h,k){var d=e.times(),l=e.values();a.strokeStyle=h,a.lineWidth=2*c.scale,a.lineCap='butt',a.lineJoin='round',a.beginPath();for(var m=!1,n=e===c.canvas.closestPred&&c.canvas.closestPred.highlight,f=!1,o=c.date.getTime()/1e3,i=-1e4,b=0;b<d.length-2;b++)if(!k||k(d[b+1])){var j=atime2screen(c,d[b]),p=acxn2screen(c,l[b]),g=atime2screen(c,d[b+1]),q=acxn2screen(c,l[b+1]);j<i&&console.log('Beuh 1.'+d[b]),g<i&&(console.log('DataSize: '+d.length),console.log('Beuh 2a. '+b+' : '+d[b-1]),console.log('Beuh 2b. '+b+' : '+d[b]),console.log('Beuh 2c. '+b+' : '+d[b+1])),i=g,n&&(a.lineWidth=4*c.scale),e.selected&&(a.lineWidth=6*c.scale,a.strokeStyle=h+1),d[b]>o&&(m||(a.stroke(),a.beginPath(),a.globalAlpha=.6,f=!1,m=!0)),g>c.topLeftX&&j<=c.bottomRightX&&(f||(a.moveTo(j,p),f=!0),a.lineTo(g,q))}else f=!1;n&&(a.lineWidth=4*c.scale),e.selected&&(a.lineWidth=6*c.scale,a.strokeStyle=h+1),a.stroke()}function drawMeasures(a,c){c.fillStyle='red',c.lineWidth=1*a.scale;for(var f=ascreen2time(a,a.mArea.mouseX),g=ascreen2acxn(a,a.mArea.mouseY),b=0;b<a.measures.length;++b){var d=atime2screen(a,a.measures[b].moment.getTime()/1e3),e=acxn2screen(a,a.measures[b].concentration.dbvalue*a.measures[b].concentration.multiplier);c.beginPath(),c.arc(d,e,5*a.scale,0,2*Math.PI,!0),c.fill(),c.stroke(),checkPointProximity(d,e,f,g,!0)&&a.mArea.isMouseOver&&(a.currentMeasure={x:d,y:e,value:a.measures[b].concentration.dbvalue.toFixed(2)+' '+a.measures[b].concentration.unitstring,time:formatDate(a.measures[b].moment),color:'red'})}}function drawTargets(d,a,p,k){var i=d.targets;if(i)for(var f=0;f<i.length;++f){a.fillStyle='blue',a.lineWidth=1*d.scale;var j,b,l,m,g,e,q=i[f].type.value,c=acxn2screen(d,i[f].cbest.dbvalue*i[f].cbest.multiplier),n=acxn2screen(d,i[f].cmax.dbvalue*i[f].cmax.multiplier),h=acxn2screen(d,i[f].cmin.dbvalue*i[f].cmin.multiplier),o=atime2screen(d,p[0]),r=atime2screen(d,p[p.length-1]);if(q<3&&(a.globalAlpha=.05,d.targetTabIndex===f&&(a.globalAlpha=.1),a.beginPath(),a.moveTo(o,c),a.lineTo(r,c),a.stroke(),a.fillRect(o,c,r-o,n-c),a.fillRect(o,h,r-o,c-h),a.stroke()),a.globalAlpha=.2,0===q&&null!==k){var s=k.troughs;for(j=0;j<s.length;++j)a.beginPath(),b=atime2screen(d,k.timeAt(s[j])),!isFinite(b)||isNaN(b)||isNaN(c)||(e=20*d.scale,(l=a.createLinearGradient(b,c,b-e,c)).addColorStop(0,'black'),l.addColorStop(1,'#F2F2FF'),(m=a.createLinearGradient(b,c,b+e,c)).addColorStop(0,'black'),m.addColorStop(1,'#F2F2FF'),a.fillStyle=l,a.fillRect(b-e,h,e,n-h),a.fillStyle=m,a.fillRect(b,h,e,n-h),a.stroke(),a.globalAlpha=1,a.beginPath(),g=6*d.scale,a.moveTo(b,c+g),a.lineTo(b,c-g),a.moveTo(b-g,c),a.lineTo(b+g,c),a.stroke(),a.globalAlpha=.2)}if(1===q&&null!==k){var t=k.peaks;for(j=0;j<t.length;++j)e=20*d.scale,a.beginPath(),b=atime2screen(d,k.timeAt(t[j])),(l=a.createLinearGradient(b,c,b-e,c)).addColorStop(0,'black'),l.addColorStop(1,'white'),(m=a.createLinearGradient(b,c,b+e,c)).addColorStop(0,'black'),m.addColorStop(1,'white'),a.fillStyle=l,a.fillRect(b-e,h,e,n-h),a.fillStyle=m,a.fillRect(b,h,e,n-h),a.stroke(),a.globalAlpha=1,a.beginPath(),g=6*d.scale,a.moveTo(b,c+g),a.lineTo(b,c-g),a.moveTo(b-g,c),a.lineTo(b+g,c),a.stroke(),a.globalAlpha=.2}}}function clearBorder(a,b){b.clearRect(0,0,a.leftMargin,a.plotHeight+a.topMargin),b.clearRect(0,a.bottomLeftY,a.plotWidth+a.leftMargin,a.bottomMargin),b.clearRect(a.topRightX,a.topRightY,a.rightMargin,a.plotHeight+a.bottomMargin),b.clearRect(a.topLeftX,0,a.plotWidth+a.rightMargin,a.topMargin)}function drawAxis(a,b){var c=5*a.scale,d=10*a.scale;b.beginPath(),b.moveTo(a.bottomLeftX,a.bottomLeftY),b.lineTo(a.bottomRightX+d,a.bottomRightY),b.stroke(),b.beginPath(),b.moveTo(a.bottomLeftX,a.bottomLeftY),b.lineTo(a.topLeftX,a.topLeftY-d),b.stroke(),b.beginPath(),b.moveTo(a.bottomRightX+d,a.bottomRightY),b.lineTo(a.bottomRightX+d-c,a.bottomRightY-c),b.lineTo(a.bottomRightX+d-c,a.bottomRightY+c),b.closePath(),b.stroke(),b.fill(),b.beginPath(),b.moveTo(a.topLeftX,a.topLeftY-d),b.lineTo(a.topLeftX-c,a.topLeftY-d+c),b.lineTo(a.topLeftX+c,a.topLeftY-d+c),b.closePath(),b.stroke(),b.fill()}function acxn2screen(a,b){return-(b-a.minY)*a.yRatio+a.bottomLeftY}function ascreen2acxn(a,b){return a.minY-(b-a.bottomLeftY)/a.yRatio}function atime2screen(a,b){return(b-a.minX)*a.xRatio+a.bottomLeftX}function ascreen2time(a,b){return a.minX+(b-a.bottomLeftX)/a.xRatio}function drawAxisTicks(a,g){g.textAlign='left',g.textBaseline='middle',g.font=a.axisTicksFontSize+' '+a.police;var i,f,o=10*a.scale,x=30*a.scale,p=.2*a.scale,w=-1,y=1,t=Math.ceil(w/p),z=Math.floor(y/p),A=t*p-w,B=-1+A,C=a.bottomLeftY-1-B,D=p*a.plotHeight/2,u=z-t+1;u>21&&(u=21);var l=2-Math.log(a.maxY-a.minY)/Math.LN10;l>=1&&l<4&&(a.unitefforder=1e3,a.unit='ng/l'),l>=4&&l<7&&(a.unitefforder=1e6,a.unit='pg/l'),l> -5&&l< -2&&(a.unitefforder=.001,a.unit='mg/l'),l> -8&&l< -5&&(a.unitefforder=1e-6,a.unit='g/l'),l<1&&l>= -2&&(a.unitefforder=1,a.unit='ug/l');for(var h=0;h<u;h++){var v=C-h*D,E=(h+t)%10?.5:1;g.beginPath(),g.moveTo(a.bottomLeftX,v),g.lineTo(a.bottomLeftX-o*E,v),g.stroke();var F=a.minY+.5*h*p*(a.maxY-a.minY);g.fillText(Math.max(0,Math.round(a.unitefforder*F)),a.bottomLeftX-5.5*o,v)}var c=[],G=ascreen2time(a,a.bottomLeftX),m=new Date(1e3*G),k=14*a.scale,j=2*k,q=!1,d=0,e=0,b=[];e=chop(a,900,b,!1,15),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,1800,b,!1,30),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,3600,b,!1,1),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,14400,b,!0,4),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,21600,b,!0,6),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,28800,b,!0,8),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,43200,b,!0,12),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,86400,b,!0,24),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,172800,b,!0,24),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,259200,b,!0,24),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,d=d>c.length?d:c.length,b=[],e=chop(a,604800,b,!0,24),f=new Date(1e3*b[0]),i=1===proportionnalInterval(b,f)?(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*j+10):(atime2screen(a,b[b.length-1])-a.bottomLeftX)/(2*k+10),c=e>d&&e<=i?b:c,q=b===c||q;var s=!1,r=0,n=0;for(h=0,f=new Date(1e3*c[0]);h<c.length;h++)g.beginPath(),g.moveTo(atime2screen(a,c[h]),a.bottomLeftY),g.lineTo(atime2screen(a,c[h]),a.bottomLeftY+o),g.stroke(),g.translate(atime2screen(a,c[h]),a.bottomLeftY+1.5*o),m=new Date(1e3*c[h]),g.fillText(formatHour(m),-k,1),h>0?(n=h>0?atime2screen(a,c[h])-atime2screen(a,c[h-1]):atime2screen(a,c[h]),f.getDate()!==m.getDate()?(s?(g.fillText(formatDay(f),-((r+n)/2)-j,30*a.scale),r=0):q?(h===c.length-1&&g.fillText(formatDay(m),-j,15*a.scale),g.fillText(formatDay(f),-n-j,15*a.scale)):g.fillText(formatDay(f),-(n/2)-j,30*a.scale),s=!1):(r+=n,h===c.length-1&&(new Date(1e3*c[h]).getDate()!==new Date(1e3*c[h-2]).getDate()?atime2screen(a,c[h])-atime2screen(a,c[h-1])>2*j+10&&g.fillText(formatDay(m),-(r/2)-j,30*a.scale):g.fillText(formatDay(m),-(r/2)-j,30*a.scale)),s=!0)):q&&1===c.length&&g.fillText(formatDay(f),-n-j,15*a.scale),f=m,g.translate(-atime2screen(a,c[h]),-(a.bottomLeftY+1.5*o)),!s&&(0===h&&0!==m.getHours()||q||(g.beginPath(),g.moveTo(atime2screen(a,c[h]),a.bottomLeftY+20*a.scale),g.lineTo(atime2screen(a,c[h]),a.bottomLeftY+20*a.scale+x),g.stroke()));g.restore(),g.save()}function proportionnalInterval(d,e){for(var a=0,b=0,g=0,f=!0,c=0;c<d.length;c++)if(c>0){var h=new Date(1e3*d[c]);h.getDate()===e.getDate()?++b>1&&c===d.length-1&&(a=a>b||f?b:a):(b++,(1!==c||c!==d.length-1)&&(a=a>b||f?b:a),b=0,f=!1,g++),e=h}return e=new Date,a=1===g?a+1:a,1===d.length&&(a=1),a}function chop(b,g,h,i,d){var e=1e3*ascreen2time(b,b.bottomLeftX),j=ascreen2time(b,b.canvas.width-b.bottomLeftX),a=new Date(e);a.setMilliseconds(0),a.setSeconds(0),a.setMinutes(0),i?a.setHours(Math.ceil(a.getHours()/d)*d%24):a.setMinutes(Math.ceil(a.getMinutes()/d)*d%60);var f=0,c=a;for(c/=1e3;c<j;)1e3*c>=e&&h.push(c),c+=g,f++;return f}function drawAxisLabels(a,b){b.font='bold '+a.fontSize+' '+a.police,b.textAlign='left',b.textBaseline='middle',b.fillText('Time',a.leftMargin+a.plotWidth+15*a.scale,a.topMargin+a.plotHeight),b.textAlign='center',b.textBaseline='bottom',b.fillText(a.unit,a.leftMargin,a.topMargin-15*a.scale),b.restore(),b.save()}function drawLegends(a,b){b.textAlign='left',b.textBaseline='Alphabetic',b.font=a.fontSize+' '+a.police;var q='Typical patient',k='Typical patient percentiles',r='A priori',s='A posteriori',t='Suggested adjustments',u='Adjustments',l='A priori percentiles',m='A posteriori percentiles',i=5*a.scale,n=10*a.scale,e=10*a.scale,f=20*a.scale,c=[],d=[],o=0,v=a.gInformationSelection.displayAposterioriPrediction&&!a.hasPatientVariates&&!a.hasMeasures,w=a.gInformationSelection.displayAposterioriPrediction&&a.hasPatientVariates&&!a.hasMeasures;m+=findEnablePercentiles(a),l+=findEnablePercentiles(a),k+=findEnablePercentiles(a),a.popP&&a.popP.predictive.predictionData.isValid&&((a.gInformationSelection.displayPopulationPrediction||v)&&(c.push({text:q,color:a.colors[1]}),d.push(b.measureText(q).width)),(a.popercsP.isValid&&a.gInformationSelection.displayPopulationPercentiles||v)&&(c.push({text:k,color:a.colors[7]}),d.push(b.measureText(k).width))),a.aprP&&a.aprP.predictive.predictionData.isValid&&((a.gInformationSelection.displayAprioriPrediction||w)&&(c.push({text:r,color:a.colors[2]}),d.push(b.measureText(r).width)),(a.aprpercsP.isValid&&a.gInformationSelection.displayAprioriPercentiles||w)&&(c.push({text:l,color:a.colors[8]}),d.push(b.measureText(l).width))),a.apoP&&a.apoP.predictive.predictionData.isValid&&(a.gInformationSelection.displayAposterioriPrediction&&(c.push({text:s,color:a.colors[4]}),d.push(b.measureText(s).width)),a.apopercsP.isValid&&a.gInformationSelection.displayAposterioriPercentiles&&(c.push({text:m,color:a.colors[6]}),d.push(b.measureText(m).width))),a.revP&&a.revP.isValid&&a.gInformationSelection.displayPossibleAdjustments&&(c.push({text:t,color:a.colors[5]}),d.push(b.measureText(t).width)),a.adjP&&a.adjP.predictive.predictionData.isValid&&a.gInformationSelection.displaySelectedAdjustments&&(c.push({text:u,color:a.colors[9]}),d.push(b.measureText(u).width));for(var p=0;p<d.length;p++)o+=d[p]+4*i+e;for(var x=Math.ceil((o+=n*(c.length-1))/a.plotWidth),B=c.length/x,y=0,z=a.leftMargin+a.plotWidth/2-o/x/2,C=a.topMargin/2-f/2-5,g=z,j=C,h=0;h<c.length;h++){var A=d[h]+4*i+e;b.fillStyle=c[h].color,b.beginPath(),b.rect(g,j,A,f),b.stroke(),b.beginPath(),b.rect(g+i,j+(f-e)/2,e,e),b.stroke(),b.fill(),b.fillStyle='black',b.beginPath(),b.fillText(c[h].text,g+3*i+e,j+(f+e)/2),g+=A+n,++y>=B&&(y=0,g=z,j+=f+n)}b.restore(),b.save()}function checkLineIntersection(c,d,f,g,h,i,k,l){var j,a,b,m,n,e={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(j=(l-i)*(f-c)-(k-h)*(g-d))||(a=d-i,b=c-h,m=(k-h)*a-(l-i)*b,n=(f-c)*a-(g-d)*b,a=m/j,b=n/j,e.x=c+a*(f-c),e.y=d+a*(g-d),a>0&&a<1&&(e.onLine1=!0),b>0&&b<1&&(e.onLine2=!0)),e}function checkPointProximity(a,b,c,d,e){return 10>=Math.abs(a-c)&&10>=Math.abs(b-d)}function formatHour(c){var a=c.getHours(),b=c.getMinutes();return(a<10?'0'+a:a)+':'+(b<10?'0'+b:b)}function formatDay(a){var b=a.getDate(),c=a.getMonth()+1;return(b<10?'0'+b:b)+'.'+(c<10?'0'+c:c)+'.'+a.getFullYear()}function formatDate(a){var b=a.getHours(),c=a.getMinutes(),d=a.getDate(),e=a.getMonth()+1;return(b<10?'0'+b:b)+':'+(c<10?'0'+c:c)+' '+((d<10?'0'+d:d)+'.'+(e<10?'0'+e:e)+'.'+a.getFullYear())}function findEnablePercentiles(b){var a=[0,0,0,0,0,0,0],c=' (',e=!1;b.gInformationSelection.perc5_95&&(a[0]='5',a[6]='95'),b.gInformationSelection.perc10_90&&(a[1]='10',a[5]='90'),b.gInformationSelection.perc25_75&&(a[2]='25',a[4]='75'),b.gInformationSelection.perc50&&(a[3]='50');for(var d=0;d<a.length;d++)0!==a[d]&&(c+=a[d],c+='-',e=!0);return e?c=c.slice(0,-1)+')':''}function drawAnnotations(a){var b,c=a.annotationsCanvas.getContext('2d');if(c.lineWidth=1,c.globalAlpha=1,a.gInformationSelection.displayPopulationPrediction&&'validation'!==a.state&&annotateDosage(a,c,a.currentDosage,a.colors[1]),a.gInformationSelection.displayAprioriPrediction&&a.gInformationSelection.displayCovariateChange)for(b=0;b<a.pvars.length;++b)annotateCovariate(a,c,a.pvars[b],a.colors[2]);if(a.currentPoints=[],a.closestPred={},a.mArea.containsMouse&&(annotatePrediction(a,c,a.popP,a.pop,a.colors[1]),annotatePrediction(a,c,a.aprP,a.apr,a.colors[2]),annotatePrediction(a,c,a.apoP,a.apo,a.colors[4]),annotatePrediction(a,c,a.adjP,a.adj,a.adjcolors[1]),null!==a.revP&&a.revP.isValid&&a.gInformationSelection.displayPossibleAdjustments)){var d=a.revP;for(b=0;b<d.size();++b)findClosestValue(a,c,d.objat(b),d.objat(b).predictionData,a.rev,a.colors[5])}}function annotatePrediction(b,e,a,c,f){if(a&&a.predictive.predictionData.isValid&&isCurveAvailable(b,c)&&(isCurveVisible(b,c)&&annotateCurveLoci(b,e,a.predictive.predictionData,c,f),findClosestValue(b,e,a.predictive,a.predictive.predictionData,c,f),a.predictive.percentilePairs.isValid))for(var g=a.predictive.percentilePairs,d=0;d<g.size();++d)findClosestValue(b,e,g.objat(d),g.objat(d).predictionData,c,f)}function annotateDosage(a,b,f,g){if(f){var j=f.applied.getTime()/1e3,k=f.endtime.getTime()/1e3,d=atime2screen(a,j),l=a.bottomLeftY,m=a.bottomLeftY,e=atime2screen(a,k),h=!0,i=!0;d<a.topLeftX-1&&e>a.topLeftX&&(d=a.topLeftX,h=!1),e>a.bottomRightX&&d<a.bottomRightX&&(e=a.bottomRightX,i=!1),b.beginPath(),b.strokeStyle=g,b.fillStyle=g,b.arc(d,l,5*a.scale,0,2*Math.PI),b.arc(e,m,5*a.scale,0,2*Math.PI),b.fill();var c=32*a.scale;h&&b.drawImage(a.img_dosages_disabled_mini,d-c,a.bottomLeftY-c,c,c),i&&b.drawImage(a.img_dosages_disabled_mini,e-c,a.bottomLeftY-c,c,c),b.stroke()}}function annotateCovariate(a,b,f,e){var c=atime2screen(a,f.date.getTime()/1e3),g=a.bottomLeftY;if(!(c<a.topLeftX)&&!(c>a.bottomRightX)){b.beginPath(),b.strokeStyle=e,b.fillStyle=e,b.arc(c,g,5*a.scale,0,2*Math.PI),b.fill();var d=32*a.scale;b.drawImage(a.img_covariates_disabled_mini,c-d,a.bottomLeftY-d,d,d),b.stroke()}}function annotateCurveLoci(b,c,d,k,j){var a,e,f,g=d.peaks,h=d.troughs,i=getAdjustmentFilter(b,!0);for(a=0,c.strokeStyle=j,c.fillStyle=j;a<g.length;++a)e=atime2screen(b,d.timeAt(g[a])),f=acxn2screen(b,d.valueAt(g[a])),(!i||i(d.timeAt(g[a])))&&e>b.topLeftX&&e<b.bottomRightX&&(c.beginPath(),c.arc(e,f,2*b.scale,0,2*Math.PI),c.fill(),c.stroke());for(a=0;a<h.length;++a)e=atime2screen(b,d.timeAt(h[a])),f=acxn2screen(b,d.valueAt(h[a])),(!i||i(d.timeAt(h[a])))&&e>b.topLeftX&&e<b.bottomRightX&&(c.beginPath(),c.arc(e,f,2*b.scale,0,2*Math.PI),c.fill(),c.stroke())}function prepareValueForDisplay(b,c){var a=c*b.unitefforder;return a>100?Math.round(a):Math.round(100*a)/100}function findClosestValue(b,o,e,c,i,p){if(!(b.mArea.tooltipX<0)||!(b.mArea.tooltipY<0)){var d,f=c.times(),j=c.values();if(c.closestPoint){for(var a=c.closestPoint.currentindex,g=Math.max(0,ascreen2time(b,b.mArea.tooltipX)),q=ascreen2acxn(b,b.mArea.tooltipY);a<f.length&&f[a]<g;)a++;for(;a>0&&f[a]>g;)a--;var k=j[a],r=j[a+1]-k,l=f[a],s=f[a+1],t=s-l,h=k+(g-l)/t*r,m=[],n=[];if(e.pointsAtMeasures&&e.pointsAtMeasures.size()>0)for(d=0;d<e.pointsAtMeasures.size();d++)m[d]=e.pointsAtMeasures.at(d).value,n[d]=1e3*e.pointsAtMeasures.at(d).time;var u={currentindex:a,pred:c,diffY:Math.abs(q-h),x:g,y:h,value:prepareValueForDisplay(b,h),time:formatDate(new Date(1e3*g)),color:p,predIndex:i,mean:prepareValueForDisplay(b,c.meanAt(a)),auc:prepareValueForDisplay(b,c.aucAt(a)),auc24:prepareValueForDisplay(b,c.auc24At(a)),cumulatedAuc:prepareValueForDisplay(b,c.cumulatedAucAt(a)),trough:prepareValueForDisplay(b,c.troughAt(a)),peak:prepareValueForDisplay(b,c.peakAt(a)),timeAfterDose:c.timeAfterDose(a),cycleDuration:c.cycleDuration(a),measurePredicted:m,measureTime:n};c.displayTooltip&&(b.currentPoints[i]=u),drawTooltips(b,o)}}}function isCurveAvailable(a,c){var d=a.gInformationSelection.displayAposterioriPrediction&&!a.hasPatientVariates&&!a.hasMeasures,e=a.gInformationSelection.displayAposterioriPrediction&&a.hasPatientVariates&&!a.hasMeasures,b=!1;switch(c){case a.pop:b=a.gInformationSelection.displayPopulationPrediction||d;break;case a.apr:b=a.gInformationSelection.displayAprioriPrediction||e;break;case a.apo:b=a.gInformationSelection.displayAposterioriPrediction;break;case a.rev:b=a.gInformationSelection.displayPossibleAdjustments;break;case a.mea:b=a.gInformationSelection.displayMeasures;break;case a.tar:b=a.gInformationSelection.displayTargets;break;case a.adj:b=a.gInformationSelection.displaySelectedAdjustment}return b}function isCurveVisible(a,b){return isCurveAvailable(a,b)}function drawTooltips(a,b){b.font=a.tooltipFontSize+' '+a.police,b.textAlign='left',b.textBaseline='Alphabetic';for(var u='T after dose:',f=b.measureText(u).width+4*a.scale,i=[],d=0;d<a.currentPoints.length;++d)if(a.currentPoints[d]){var v=getAdjustmentFilter(a,a.currentPoints[d].predIndex!==a.adj),w=a.currentPoints[d].x;if((!v||v(w))&&isCurveVisible(a,d)&&a.mArea.tooltipX>a.topLeftX&&(e=atime2screen(a,a.currentPoints[d].x),h=acxn2screen(a,a.currentPoints[d].y),b.beginPath(),b.arc(e,h,4*a.scale,0,2*Math.PI,!0),b.fillStyle=a.currentPoints[d].color,b.fillStyle='#e6e6e6',b.fill(),b.stroke(),!a.currentMeasure)){x=f+(Math.max(b.measureText(a.currentPoints[d].value).width,b.measureText(a.currentPoints[d].time).width)+2),l=(134+28*a.currentPoints[d].measureTime.length)*a.scale,e-=x/2,h=h-l-10*a.scale;for(var x,l,e,h,j,k=0;k<i.length;++k)h+l+5*a.scale>i[k]&&h<i[k]+l+5*a.scale&&(h=i[k]-l-5*a.scale);i.push(h),b.beginPath(),b.rect(e,h,x,l),b.globalAlpha=1,b.fill(),b.globalAlpha=1,b.stroke(),b.fillStyle='black';var g=e+2,c=h+12*a.scale;b.fillText('Time:',g,c),b.fillText(a.currentPoints[d].time,e+f,c),c+=14*a.scale,b.fillText(u,g,c),b.fillText(a.currentPoints[d].timeAfterDose+'h',e+f,c),c+=14*a.scale,b.fillText('C predicted:',g,c),b.fillText(a.currentPoints[d].value+' '+a.unit,e+f,c),c+=14*a.scale;var m=a.currentPoints[d].mean;m>0||(m='-'),b.fillText('C average:',g,c),b.fillText(m+' '+a.unit,e+f,c),c+=14*a.scale;var n=a.currentPoints[d].trough;n>0||(n='-'),b.fillText('C trough:',g,c),b.fillText(n+' '+a.unit,e+f,c),c+=14*a.scale;var o=a.currentPoints[d].peak;o>0||(o='-'),b.fillText('C peak:',g,c),b.fillText(o+' '+a.unit,e+f,c),c+=14*a.scale;var p=a.currentPoints[d].auc;p>0||(p='-'),b.fillText('AUC ('+a.currentPoints[d].cycleDuration+'h):',g,c),b.fillText(p+' '+a.unit+'*h',e+f,c),c+=14*a.scale;var q=a.currentPoints[d].auc24;q>0||(q='-'),b.fillText('AUC (24h):',g,c),b.fillText(q+' '+a.unit+'*h',e+f,c),c+=14*a.scale;var r=a.currentPoints[d].cumulatedAuc;if(r>0||(r='-'),b.fillText('Cum. AUC',g,c),b.fillText(r+' '+a.unit+'*h',e+f,c),a.currentPoints[d].measureTime.length>0)for(j=0;j<a.currentPoints[d].measureTime.length;j++){c+=14*a.scale;var s='Value at ',t=formatDate(new Date(a.currentPoints[d].measureTime[j]));b.fillText(s,g,c),b.fillText(t,e+f,c),c+=14*a.scale,s='is : ',t=prepareValueForDisplay(a,a.currentPoints[d].measurePredicted[j])+' '+a.unit,b.fillText(s,g,c),b.fillText(t,e+f,c)}}}b.restore(),b.save()}";

const string FileString::tuberxpertJsStr = "'use strict';function fillImages(){for(var b=document.getElementsByClassName('warning-icon'),a=0;a<b.length;++a)b[a].setAttribute('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA3QAAAN0BcFOiBwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASbSURBVFiFxZdtTJVlGMd/1/2cl+cgHOSgCKjTlGFEFDrUGAIBQ8DICeopRXHK8syXWetbH3RuuvVFp261am2t1Rc3+yK51cS5UEcvY9ZW0idbrJjhS04BhfN29eEArgx4Dtj6f7xf/tfvvq77fp77FlXl/5RruhM3bg/laDTccOtmX0Qi5sKlS1/emI6PJJuB9aFQimcw8plCA0D/jd8THcoXw2n2pu729gf/GUAwGPTF3KnngOq56bBqmZDlvc+ZzkGu98cALsaHBxu7uroeOvVMqgRRz6xDolQ/lS0c3m5ItQFm0/BCKvuO/8FPfbFq4007BLzl1NNxBja1tC1RtMcyeE+ELObP+Xv/3b4hmt6+TTTOiFj6zOWOjl+c+BqnpKp6DPA2rJTHggNkZKfwymoPgFejcsypryOA5q27qhGa/CkQrJhgiiW01ftJ9wkITWU1ddVPBCAYDFpGOAmwpcowy060D4fh9FdxPmi/x8ORRBk9gRT2vOgdNdaTwWDQmjFA3J26W6Fo8TyhdrmMt3dcVc5cVk5ffMDZKwOJRkt4qSyNvCyDKkV9d+7unhFAY0tLhsIRgF11gjyKz683E6s2xuJ6X2S8XdJ9vLk2kSZROVJe3pgxbQAb72Egs7RAKFwkkw19JEt4rmAWVctcAJm4w4enBdD86msFCnvdLthR6/iwJOS32V9j43GBwt7SytqCpAHEip0AXBtKhbnpycXHMsyb72PrKg+Ay2XJiaQAmrftagTqMv3QVJbk6sfkt9lW6iUrTVCoK6+qa3QEEAqF3KJyHGB7jcHrnl58LIMdsNlTmTiWKnq8pKTkMbfHAG4PRQ+A5i9bIJQ/63DjTSS/TW2hm6L5FkC+Ly1wYFKA5tbWLFQPCtBWP8PgAJYBv83rNV4EQDhYVleXNSGAibqPAulVxcLSnMkBvGP/UVVszyRj/TZP51isK3KjkG4iHP1XgKaWncUq2ubzQEvV1BuvuliYZYPHFWNdaerEA0ezEKrwkOIRFG0rq1pbPNY9fh8wcAowm8oNsyfxG1NervDhGxaqOZNnAMBvE7g/zI5SN+91ho0Ip4DK0bjQ3LJzM0hFdgAaVzuvvdfN1MFhPAvBEg8LMgxARXnN2s0AVm9vrx2OSTswe/96w8K5zgDuDcG7n8c5d+UOK/K9+LxTlM1jYQ2OkO0XLvwcBVj16ccfvW8GwqYVWPT8EmFlvvPVn7+qdPUo3/REOXt5cOoJo1lYk+di5WILYFFUPK1GVesBNq5J7tjl5YIAqnEKFnucTUpLfJR2lCbGq2q9C6HSCOQvSA5g+VLhnX0WkWgWC7Mc3m1dFhihMNfCCMSh0iD0xxV6epN/IWUHcB4cIBKDuPL9bzHiCiL0G1HtBDj7tTISmcphhhoYZjiinP4uDIDG6ZSXt+ye45bINSDL54XKIiE303k5HgxNvQEDPojcH+Fab5jz16IMhRXgplsjhaKqbNi2s8il8olC8VRm/9T40yw5/RCPaWtXZ8eP4w+TUCjkvjUQXY3oCkECTlxU1XWrvy/qNGpc+dNo/OrDgbvfdnd3R2Aaj9Mnrb8A0TtykI+7cqgAAAAASUVORK5CYII=');for(var b=document.getElementsByClassName('dot-icon'),a=0;a<b.length;++a)b[a].setAttribute('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAPCAYAAAACsSQRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAANsAAADbAfBQ5pwAAACnSURBVDhPY6AlMADi2UB8Hoi/Q2kQ3wKICQIWIC4BYpDG/1jwbyBuAGKQOpwAZAA2zegYZBBWAPICLhegY5CLQOrBgAlKg0A2EHNAmAQByDvJECaqISZQmliANZCJ9QoMfwZiMEB2yQ0oTSy4A6VRDDkDpYkFWNWD/AgKdWxOR8cgdTgTHij+sWlCx91AjBOAog5kEC4XgcRBBuBNsTBAUd4hAzAwAAAOk1RgOtjufQAAAABJRU5ErkJggg==')}function makeDate(d){var c=d.split('T'),e=c[0],f=c[1],a=e.split('-'),b=f.split(':');return new Date(a[0],a[1],a[2],b[0],b[1],b[2])}function addTargets(d,c){for(var b=0;b<c.length;b++){var a=-1;switch(c[b][0]){case'residual':a=0;break;case'peak':a=1;break;case'mean':a=2;break;case'auc':a=3;break;case'auc24':a=4;break;case'cumulativeAuc':a=5;break;case'aucDividedByMic':a=6;break;case'auc24DividedByMic':a=7;break;case'aucOverMic':a=8;break;case'auc24OverMic':a=9;break;case'peakDividedByMic':a=10;break;case'timeOverMic':a=11;break;case'residualDividedByMic':a=12}d.targets.push(new GraphTarget(a,c[b][1],c[b][2],c[b][3]))}}function addPredictionData(a,d,c,e){for(var b=0;b<c.length;b++)a.predictionData.time.push(3600*c[b]+d.getTime()/1e3),a.predictionData.value.push(e[b]);return a.predictionData.troughs.push(a.predictionData.value.length-1),a}function displayGraphs(a,c,h,i){a.timestart=makeDate(h),a.timeend=makeDate(i),a.revP.isValid=!0,a.scale=1;for(var b=0;b<c.length;b++){for(var e=new GraphAdjustment,d=0;d<c[b].length;d++)e=addPredictionData(e,makeDate(c[b][d][0]),c[b][d][1],c[b][d][2]);if(e.predictionData.isValid=!0,a.revP.append(e),0==b){var f=document.getElementById('canBestAdj');a.updateChartDimensions(f),a.canvas=f,a.annotationsCanvas=f,a.clockCanvas=f,drawGraph(a)}}var g=document.getElementById('canAllAdj');a.updateChartDimensions(g),a.canvas=g,a.annotationsCanvas=g,a.clockCanvas=g,drawGraph(a)}";

} // namespace Xpert
} // namespace Tucuxi
