<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<query version="1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="custom_computing_query.xsd">
    <queryId>rifampicin_1</queryId>
    <clientId>124568</clientId>
    <date>2018-07-11T13:45:30</date> <!-- Date the xml has been sent -->
    <language>en</language>

    <admin>
		<mandator>
			<person>
				<firstName>John</firstName>
				<lastName>Doe</lastName>
				<address>
					<street>Av. de l'Ours 2</street>
					<postCode>1010</postCode>
					<city>Lausanne</city>
				</address>
				<phone>
					<number>0213140002</number>
				</phone>
				<email>
					<address>john.doe@chuv.com</address>
				</email>
			</person>
			<institute>
				<address>
				</address>
				<phone>
				</phone>
				<email>
				</email>
			</institute>
		</mandator>
	</admin>

    <drugTreatment>
        <!-- All the information regarding the patient -->
        <patient>
            <covariates>
                <covariate>
                    <covariateId>ffm</covariateId>
                    <date>2018-07-11T10:45:30</date>
                    <value>40</value>
                    <unit>kg</unit>
                      <dataType>double</dataType>
                    <nature>continuous</nature>
                </covariate>
            </covariates>
        </patient>
        <!-- List of the drugs informations we have concerning the patient -->
        <drugs>
            <!-- All the information regarding the drug -->
            <drug>
                <drugId>rifampicin</drugId>
                <activePrinciple>something</activePrinciple>
                <brandName>somebrand</brandName>
                <atc>something</atc>
                <!-- All the information regarding the treatment -->
                <treatment>
                    <dosageHistory>
                        <dosageTimeRange>
                            <start>2018-07-06T08:00:00</start>
                            <end>2018-07-08T08:00:00</end>
                            <dosage>
                                <dosageLoop>
                                    <lastingDosage>
                                        <interval>12:00:00</interval>
                                        <dose>
                                            <value>800</value>
                                            <unit>mg</unit>
                                            <infusionTimeInMinutes>60</infusionTimeInMinutes>
                                        </dose>
                                        <formulationAndRoute>
                                            <formulation>parenteralSolution</formulation>
                                            <administrationName>foo bar</administrationName>
                                            <administrationRoute>oral</administrationRoute>
                                            <absorptionModel>extravascular</absorptionModel>
                                        </formulationAndRoute>
                                    </lastingDosage>
                                </dosageLoop>
                            </dosage>
                        </dosageTimeRange>
                    </dosageHistory>
                </treatment>
                <!-- Samples history -->
                <samples>
                    <sample>
                        <sampleId>123456</sampleId>
                        <sampleDate>2018-07-07T03:00:00</sampleDate>
                        <concentrations>
                            <concentration>
                                <analyteId>rifampicin</analyteId>
                                <value>7</value>
                                <unit>mg/l</unit>
                            </concentration>
                        </concentrations>
                    </sample> 
                </samples>
                <!-- Personalised targets -->
                <targets>
                    <!-- It's the same node we can find in the drug model xml file -->
                    <target>
                        <activeMoietyId>rifampicin</activeMoietyId>
                        <targetType>residual</targetType>
                        <unit>mg/l</unit>
                        <min>20</min>
                        <best>25</best>
                        <max>30</max>
                        <inefficacyAlarm>15</inefficacyAlarm>
                        <toxicityAlarm>50</toxicityAlarm>
                    </target>
                </targets>
            </drug>
        </drugs>
    </drugTreatment>
    <!-- List of the requests we want the server to take care of -->
    <requests>
        <requestXpert>
            <drugId>rifampicin</drugId>
            <localComputation>true</localComputation>
            <output>
                <format>xml</format>
                <language>en</language>
            </output>
            <adjustmentDate>2018-07-06T08:00:00</adjustmentDate>
            <options>
                <bestCandidatesOption>bestDosage</bestCandidatesOption>
                <loadingOption>noLoadingDose</loadingOption>
                <restPeriodOption>noRestPeriod</restPeriodOption>
                <steadyStateTargetOption>atSteadyState</steadyStateTargetOption>
                <targetExtractionOption>populationValues</targetExtractionOption>
                <formulationAndRouteSelectionOption>lastFormulationAndRoute</formulationAndRouteSelectionOption>
            </options>
        </requestXpert>
        <request>
            <requestId>population_1</requestId>
            <drugId>rifampicin</drugId>
            <drugModelId>ch.tucuxi.rifampicin.svensson2017</drugModelId>
            <predictionTraits>
              <computingOption>
                <parametersType>population</parametersType>
                <compartmentOption>allActiveMoieties</compartmentOption>
                <retrieveStatistics>true</retrieveStatistics>
                <retrieveParameters>true</retrieveParameters>
                <retrieveCovariates>true</retrieveCovariates>
              </computingOption>
              <nbPointsPerHour>20</nbPointsPerHour>
              <dateInterval>
                  <start>2018-07-06T08:00:00</start>
                  <end>2018-07-08T08:00:00</end>
              </dateInterval>
            </predictionTraits>
        </request>
    </requests>
</query>
